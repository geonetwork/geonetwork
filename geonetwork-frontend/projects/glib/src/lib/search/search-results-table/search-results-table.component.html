@if (search) {
  @if (search.response(); as response) {
    <p-table
      [lazy]="true"
      [loading]="search.isSearching()"
      [value]="response.hits.hits"
      [columns]="fields()"
      [paginator]="true"
      [rows]="search.pageSize()"
      [first]="search.from()"
      [totalRecords]="search.response().hits.total.value"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      (onPage)="pageChange($event)"
      [rowsPerPageOptions]="[10, 25, 50]"
      [selectionMode]="selectionMode()"
      [(selection)]="selectedRecords"
      metaKeySelection="true"
      [tableStyle]="{ 'min-width': '60rem' }"
      [scrollHeight]="scrollHeight()">
      <ng-template pTemplate="caption">
        <div class="flex align-items-center justify-content-between">
          {{ response.hits.total.value }} records found

          @if (selectionMode() === 'multiple') {
            ({{ selectedRecords.length }} selected)
          }
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          @for (fieldLabel of labels() || fields(); track $index) {
            <th>{{ fieldLabel }}</th>
          }
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-hit let-rowIndex="rowIndex">
        <tr [pSelectableRow]="hit" [pSelectableRowIndex]="rowIndex">
          @for (field of fields(); track $index) {
            <td>
              <ng-template #column_content>
                @switch (field) {
                  @case ('overview[*]') {
                    <g-record-field-overview
                      [field]="hit._source | gJsonpath: field" />
                  }
                  @case ('resourceType[0]') {
                    <g-record-field-resource-type
                      [layout]="ResourceTypeLayout.ICON"
                      [field]="hit._source | gJsonpath: field" />
                  }
                  @default {
                    @if (field.startsWith('link')) {
                      <g-record-field-links
                        [field]="hit._source | gJsonpath: field" />
                    } @else if (field.startsWith('th_')) {
                      <g-record-field-keywords
                        [field]="hit._source | gJsonpath: field" />
                    } @else {
                      {{ hit._source | gJsonpath: field }}
                    }
                  }
                }
              </ng-template>

              @if (landingPageLinkOn() === field) {
                <a
                  class="text-blue-500 underline"
                  [attr.href]="buildLandingPageLink(hit._id)">
                  <ng-container *ngTemplateOutlet="column_content" />
                </a>
              } @else {
                <ng-container *ngTemplateOutlet="column_content" />
              }
            </td>
          }
        </tr>
      </ng-template>
    </p-table>
  }
}
