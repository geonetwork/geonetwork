@if (analysisResult()) {
  <div class="grid grid-cols-1 gap-5" #dataAnalysisPanel>
    <div class="grid grid-cols-1 items-center">
      <label class="text-gray-800 font-semibold">Title</label>
      <div class="inline-flex items-center">
        <g-inplace-field
          property="resourceTitleObject"
          [uuid]="uuid()"
          [(value)]="analysisResult().resourceTitleObject.default" />

        @if (isVector()) {
          dataset contains
          <span class="font-bold"
            >&nbsp;{{ analysisResult().featureCount[0] }}&nbsp;</span
          >
          features.
        }
      </div>
    </div>

    <div class="grid grid-cols-1 items-center">
      <label class="text-gray-800 font-semibold">Source</label>
      <div class="">
        {{ analysisResult().link[0].urlObject.default }}
      </div>
    </div>

    <div>
      <label class="text-gray-800 font-semibold">Format</label>
      <div class="">{{ analysisResult().format[0] }}</div>
    </div>

    @if (spatialRepresentation) {
      <div>
        <label class="text-gray-800 font-semibold"
          >Spatial representation</label
        >
        <div class="">
          <i
            [attr.class]="
              isVector()
                ? 'fa fa-fw fa-vector-square'
                : 'fa fa-fw fa-table-cells'
            "></i>
          {{ spatialRepresentation }}
        </div>
      </div>
    }
    @if (analysisResult().resolutionDistance) {
      <div>
        <label class="text-gray-800 font-semibold">Resolution</label>
        <div class="grid grid-cols-2 gap-5">
          @for (
            resolution of analysisResult().resolutionDistance;
            track $index
          ) {
            {{ resolution }}
          }
        </div>
      </div>
    }
    @if (analysisResult().dimensionSizeY && analysisResult().dimensionSizeX) {
      <div>
        <label class="text-gray-800 font-semibold">Dimension</label>
        <div class="grid grid-cols-2 gap-5">
          {{ analysisResult().dimensionSizeX[0] }} x
          {{ analysisResult().dimensionSizeY[0] }}
        </div>
      </div>
    }

    @if (isVector() && analysisResult().geom) {
      <div>
        <label class="text-gray-800 font-semibold">Geometry type</label>
        <div class="grid grid-cols-2 gap-5">
          {{ analysisResult().cl_geometricObjectType[0].key }}
        </div>
      </div>
      <div>
        <label class="text-gray-800 font-semibold">Spatial extent</label>
        <div class="grid grid-cols-2 gap-5">
          {{ analysisResult().geom }}
        </div>
      </div>
    }

    @if (isRaster()) {
      @if (analysisResult().geom) {
        <div>
          <label class="text-gray-800 font-semibold">Spatial extent</label>
          <div class="grid grid-cols-2 gap-5">
            {{ analysisResult().geom }}
          </div>
        </div>
      }
      @if (analysisResult()?.shape) {
        <div>
          <label class="text-gray-800 font-semibold">Foot print</label>
          <div class="grid grid-cols-2 gap-5">
            {{ analysisResult().shape | json }}
          </div>
        </div>
      }
      @if (analysisResult().size) {
        <div>
          <label class="text-gray-800 font-semibold">Dimensions</label>
          <div class="grid grid-cols-2 gap-5">
            X: {{ analysisResult().size[0] }} / Y:
            {{ analysisResult().size[1] }}
          </div>
        </div>
      }
    }

    @for (crs of analysisResult().coordinateSystem; track $index) {
      <div>
        <label class="text-gray-800 font-semibold">Coordinate system</label>
        <div class="grid grid-cols-2 gap-5">
          <a
            href="http://epsg.io/{{ crs.replace('EPSG:', '') }}"
            target="_blank"
            >{{ crs }}</a
          >
        </div>
      </div>
    }

    @if (isVector()) {
      <div>
        <label class="text-gray-800 font-semibold">Data model</label>
        <p-table
          [value]="analysisResult().featureTypes"
          styleClass="w-full"
          tableStyleClass="w-full">
          <ng-template pTemplate="header">
            <tr>
              <th>Column name</th>
              <th>Column type</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-field>
            <tr>
              <td>{{ field.code }}</td>
              <td>{{ field.typeName }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <!--      @if (!analysisResult().geom) {
        <label class="text-gray-800 font-semibold">Spatial extent?</label>
        <div class="grid grid-cols-2 gap-5">
          <p-select
            [options]="analysisResult().featureTypes"
            placeholder="Compute spatial extent from attribute"
            optionLabel="code"
            optionValue="code" />
        </div>
      }-->

      @if (analysisResult().featureTypes) {
        <div>
          <label class="text-gray-800 font-semibold">Temporal extent?</label>
          <div class="grid grid-cols-2 gap-5">
            <g-inplace-field
              property="dateRangeDetails"
              [(value)]="temporalExtent"
              [uuid]="uuid()"
              [active]="hasComputedStatistics()[StatsType.TEMPORAL]">
              <ng-template #display>
                <span class="font-bold">
                  {{ temporalExtent()?.start.date }} -
                  {{ temporalExtent()?.end.date }}
                </span>
              </ng-template>
              <ng-template #edit let-onFieldValueChange="onFieldValueChange">
                <g-temporal-extent-field
                  [from]="
                    temporalExtentStats()
                      ? String(temporalExtentStats()![0].statistics.MIN)
                      : temporalExtent()?.start.date || undefined
                  "
                  [to]="
                    temporalExtentStats()
                      ? String(temporalExtentStats()![0].statistics.MAX)
                      : temporalExtent()?.end.date || undefined
                  "
                  (onChange)="onFieldValueChange($event)"
                  [appendTo]="dataAnalysisPanel" />
              </ng-template>
            </g-inplace-field>

            <p-select
              [options]="analysisResult().featureTypes"
              (onChange)="getStatistics($event, StatsType.TEMPORAL)"
              placeholder="Analyse column"
              tooltip="Select the column to compute the temporal extent from"
              tooltipPosition="bottom"
              optionLabel="code"
              optionValue="code"
              [appendTo]="dataAnalysisPanel" />

            @if (isComputingStatistics()[StatsType.TEMPORAL]) {
              <p-progressBar
                mode="indeterminate"
                [style]="{ height: '6px' }"
                class="flex-auto" />
            }
          </div>
        </div>
        <div>
          <label class="text-gray-800 font-semibold">Vertical extent?</label>
          <div class="grid grid-cols-2 gap-5">
            <g-inplace-field
              property="resourceVerticalRange"
              [(value)]="resourceVerticalRange"
              [uuid]="uuid()"
              [active]="hasComputedStatistics()[StatsType.VERTICAL]">
              <ng-template #display>
                <span class="font-bold">
                  {{ resourceVerticalRange()?.gte }} -
                  {{ resourceVerticalRange()?.lte }}
                  {{ resourceVerticalRange()?.unit }}
                </span>
              </ng-template>
              <ng-template #edit let-onFieldValueChange="onFieldValueChange">
                <g-vertical-extent-field
                  [gte]="resourceVerticalRange()?.gte"
                  [lte]="resourceVerticalRange()?.lte"
                  (onChange)="onFieldValueChange($event)" />
              </ng-template>
            </g-inplace-field>

            <p-select
              [options]="analysisResult().featureTypes"
              placeholder="Analyse column"
              tooltip="Select the column to compute the vertical extent from"
              tooltipPosition="bottom"
              (onChange)="getStatistics($event, StatsType.VERTICAL)"
              optionLabel="code"
              optionValue="code"
              [appendTo]="dataAnalysisPanel" />

            @if (isComputingStatistics()[StatsType.VERTICAL]) {
              <p-progressBar
                mode="indeterminate"
                [style]="{ height: '6px' }"
                class="flex-auto" />
            }
          </div>
        </div>
      }
    } @else {
      <div>
        <label class="text-gray-800 font-semibold">Temporal extent?</label>
        <div class="grid grid-cols-2 gap-5">
          <g-inplace-field
            property="dateRangeDetails"
            [(value)]="temporalExtent"
            [uuid]="uuid()">
            <ng-template #display>
              <span class="font-bold">
                {{ temporalExtent()?.start.date }} -
                {{ temporalExtent()?.end.date }}
              </span>
            </ng-template>
            <ng-template #edit let-onFieldValueChange="onFieldValueChange">
              <g-temporal-extent-field
                (onChange)="onFieldValueChange($event)"
                [appendTo]="dataAnalysisPanel" />
            </ng-template>
          </g-inplace-field>
        </div>
      </div>
    }

    <div>
      <label class="text-gray-800 font-semibold">Resource identifier</label>
      <g-inplace-field
        property="resourceIdentifier"
        [uuid]="uuid()"
        [(value)]="resourceIdentifier" />
    </div>
  </div>
}
