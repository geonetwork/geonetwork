@if (analysisResult()) {
  @let spatialRepresentation =
    analysisResult().cl_spatialRepresentationType[0].key;
  @let isVector = spatialRepresentation === 'vector';
  @let isTabular = spatialRepresentation === 'textTable';
  @let isRaster = spatialRepresentation === 'grid';

  <div class="grid grid-cols-8 gap-4 items-center">
    <div class="font-medium">Title</div>
    <div class="col-span-7">
      <div class="inline-flex items-center">
        <g-inplace-field
          property="resourceTitleObject"
          [uuid]="uuid()"
          [(value)]="analysisResult().resourceTitleObject.default" />

        @if (isVector) {
          dataset contains
          <span class="font-bold"
            >&nbsp;{{ analysisResult().featureCount[0] }}&nbsp;</span
          >
          features.
        }
      </div>
    </div>
  </div>
  <div class="grid grid-cols-8 gap-4 items-center">
    <div class="font-medium">Resource identifier</div>
    <div class="col-span-7">
      <g-inplace-field
        property="resourceIdentifier"
        [uuid]="uuid()"
        [(value)]="resourceIdentifier" />
    </div>

    <div class="font-medium">Source</div>
    <div class="col-span-7">
      {{ analysisResult().link[0].urlObject.default }}
    </div>

    <div class="font-medium">Format</div>
    <div class="col-span-7">{{ analysisResult().format[0] }}</div>

    @if (spatialRepresentation) {
      <div class="font-medium">Spatial representation</div>
      <div class="col-span-7">
        <i
          [attr.class]="
            isVector ? 'fa fa-fw fa-vector-square' : 'fa fa-fw fa-table-cells'
          "></i>
        {{ spatialRepresentation }}
      </div>
    }
    @if (analysisResult().resolutionDistance) {
      <div class="font-medium">Resolution</div>
      <div class="col-span-7">
        @for (resolution of analysisResult().resolutionDistance; track $index) {
          {{ resolution }}
        }
      </div>
    }
    @if (analysisResult().dimensionSizeY && analysisResult().dimensionSizeX) {
      <div class="font-medium">Dimension</div>
      <div class="col-span-7">
        {{ analysisResult().dimensionSizeX[0] }} x
        {{ analysisResult().dimensionSizeY[0] }}
      </div>
    }

    @if (isVector && analysisResult().geom) {
      <div class="font-medium">Geometry type</div>
      <div class="col-span-7">
        {{ analysisResult().cl_geometricObjectType[0].key }}
      </div>

      <div class="font-medium">Spatial extent</div>
      <div class="col-span-7">
        {{ analysisResult().geom }}
      </div>
    }

    @if (isRaster) {
      @if (analysisResult().geom) {
        <div class="font-medium">Spatial extent</div>
        <div class="col-span-7">
          {{ analysisResult().geom }}
        </div>
      }
      @if (analysisResult()?.shape) {
        <div class="font-medium">Foot print</div>
        <div class="col-span-7">
          {{ analysisResult().shape | json }}
        </div>
      }
      @if (analysisResult().size) {
        <div class="font-medium">Dimensions</div>
        <div class="col-span-7">
          X: {{ analysisResult().size[0] }} / Y: {{ analysisResult().size[1] }}
        </div>
      }
    }

    @for (crs of analysisResult().coordinateSystem; track $index) {
      <div class="font-medium">Coordinate system</div>
      <div class="col-span-7">
        <a
          href="http://epsg.io/{{ crs.replace('EPSG:', '') }}"
          target="_blank"
          >{{ crs }}</a
        >
      </div>
    }

    @if (isVector) {
      <div class="font-medium">Data model</div>
      <div class="col-span-7">
        <p-table
          [value]="analysisResult().featureTypes"
          styleClass="w-full"
          tableStyleClass="w-full">
          <ng-template pTemplate="header">
            <tr>
              <th>Column name</th>
              <th>Column type</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-field>
            <tr>
              <td>{{ field.code }}</td>
              <td>{{ field.typeName }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      @if (isRaster) {
        @if (analysisResult()) {
          <div class="font-medium">Temporal extent</div>
          <div class="col-span-7">
            {{ analysisResult() }}
          </div>
        }
      }
      <!--      @if (!analysisResult().geom) {
        <div class="font-medium">Spatial extent?</div>
        <div class="col-span-7">
          <p-select
            [options]="analysisResult().featureTypes"
            placeholder="Compute spatial extent from attribute"
            optionLabel="code"
            optionValue="code" />
        </div>
      }-->

      @if (analysisResult().featureTypes) {
        <div class="font-medium">Temporal extent?</div>
        <div class="col-span-7 flex gap-2">
          <p-select
            [options]="analysisResult().featureTypes"
            (onChange)="getStatistics($event)"
            placeholder="Compute temporal extent from attribute"
            optionLabel="code"
            optionValue="code" />

          @if (isComputingStatistics()) {
            <p-progressBar
              mode="indeterminate"
              [style]="{ height: '6px' }"
              class="flex-auto" />
          }
          @if (
            temporalExtentStats() &&
            temporalExtentStats()![0] &&
            temporalExtentStats()![0].statistics
          ) {
            <g-inplace-field
              property="dateRangeDetails"
              [(value)]="temporalExtent"
              [uuid]="uuid()">
              <ng-template #display>
                <span class="font-bold">
                  {{ temporalExtent()?.start.date }} -
                  {{ temporalExtent()?.end.date }}
                </span>
              </ng-template>
              <ng-template #edit let-onFieldValueChange="onFieldValueChange">
                <g-temporal-extent-field
                  [from]="String(temporalExtentStats()![0].statistics.MIN)"
                  [to]="String(temporalExtentStats()![0].statistics.MAX)"
                  (onChange)="onFieldValueChange($event)" />
              </ng-template>
            </g-inplace-field>
          }
        </div>

        <!--<div class="font-medium">Vertical extent?</div>
        <div class="col-span-7">
          <p-select
            [options]="analysisResult().featureTypes"
            placeholder="Compute vertical extent from attribute"
            optionLabel="code"
            optionValue="code" />
        </div>-->
      }
    }
  </div>
}
